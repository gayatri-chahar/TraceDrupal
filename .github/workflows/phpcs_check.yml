name: Check PHPCS Issues on Push

on:
  push:
    branches:
      - Trace_branch-01
      - develop
      # You can also add 'pull_request' here if you want to block PRs from merging with errors:
      # - pull_request

jobs:
  phpcs_check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4

      - name: Setup PHP environment
        # Uses the shivammathur/setup-php action to configure the correct PHP version and extensions
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3.27' # Adjust to your Drupal project's required PHP version
          extensions: mbstring, xml, pdo_mysql, zip, gd, curl
          tools: composer

      - name: Install Composer dependencies
        # This assumes your Drupal/custom module project has 'drupal/coder' in the 'require-dev' section
        run: composer install --prefer-dist --no-progress --no-interaction

      - name: Run PHP Code Sniffer (PHPCS)
        run: |
          # 1. Register the Drupal standards with phpcs (optional for newer coder versions, but safe to leave)
          ./vendor/bin/phpcs --config-set installed_paths vendor/drupal/coder/coder_sniffer
          
          # 2. Check and scan 'modules/custom' if it exists, otherwise skip with a warning/info message
          if [ -d "modules/custom" ]; then
            echo "Directory modules/custom found. Running PHPCS..."
            ./vendor/bin/phpcs --standard=Drupal,DrupalPractice --extensions=php,module,inc,install,test,profile,theme,css,info,txt,md modules/custom themes/custom
          else
            echo "Directory modules/custom not found or empty. Skipping PHPCS scan for this path."
            # Exit code 0 ensures the overall job doesn't fail just because a path is missing.
          fi
        # If you only want to scan 'themes/custom' regardless of the 'modules/custom' existence, 
        # consider running that in a separate 'if' block or combine paths that always exist.